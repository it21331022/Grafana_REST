{
    "apiVersion": "2021-10-01",
    "location": "eastasia",
    "name": "inventory-app",
    "properties": {
      "containers": [
        {
          "name": "inventory-service",
          "properties": {
            "image": "myinventoryacr.azurecr.io/inventory_service:latest",
            "ports": [
              {
                "port": 8080,
                "protocol": "TCP"
              }
            ],
            "resources": {
              "requests": {
                "cpu": 1,
                "memoryInGB": 1.5
              }
            },
            "environmentVariables": [
              {
                "name": "FLASK_ENV",
                "value": "production"
              }
            ]
          }
        },
        {
          "name": "prometheus",
          "properties": {
            "image": "prom/prometheus:latest",
            "ports": [
              {
                "port": 9090,
                "protocol": "TCP"
              }
            ],
            "resources": {
              "requests": {
                "cpu": 1,
                "memoryInGB": 1.5
              }
            },
            "command": [
              "--config.file=/etc/prometheus/prometheus.yml"
            ],
            "volumeMounts": [
              {
                "name": "prometheus-config",
                "mountPath": "/etc/prometheus",
                "readOnly": true
              }
            ]
          }
        },
        {
          "name": "grafana",
          "properties": {
            "image": "grafana/grafana:latest",
            "ports": [
              {
                "port": 3000,
                "protocol": "TCP"
              }
            ],
            "resources": {
              "requests": {
                "cpu": 1,
                "memoryInGB": 1.5
              }
            },
            "environmentVariables": [
              {
                "name": "GF_SECURITY_ADMIN_PASSWORD",
                "value": "securepassword123"
              }
            ],
            "volumeMounts": [
              {
                "name": "grafana-config",
                "mountPath": "/etc/grafana/provisioning/datasources",
                "readOnly": true
              },
              {
                "name": "grafana-dashboard",
                "mountPath": "/etc/grafana/provisioning/dashboards",
                "readOnly": true
              }
            ]
          }
        }
      ],
      "imageRegistryCredentials": [
        {
          "server": "myinventoryacr.azurecr.io",
          "username": "myinventoryacr",
          "password": "A7ZtDGJDKCKBUhVLcT/cSgv7m9LdRaSdfblYKpa4Fl+ACRAdtJtS"
        }
      ],
      "ipAddress": {
        "type": "Public",
        "ports": [
          {
            "port": 8080,
            "protocol": "TCP"
          },
          {
            "port": 9090,
            "protocol": "TCP"
          },
          {
            "port": 3000,
            "protocol": "TCP"
          }
        ],
        "dnsNameLabel": "inventory-app"
      },
      "osType": "Linux",
      "restartPolicy": "Always",
      "volumes": [
        {
          "name": "prometheus-config",
          "azureFile": {
            "shareName": "prometheus-data",
            "storageAccountName": "mystorageaccountgraf",
            "storageAccountKey": "WWTaza86E7DiNwZ0oH6YHYNy4gtBiS73HR/4Wlb4r1JLILg+c99MSyPbwteZ5v0H2ZZ3dE7TNWyI+AStDkZ0QA=="
          }
        },
        {
          "name": "grafana-config",
          "azureFile": {
            "shareName": "grafana-data",
            "storageAccountName": "mystorageaccountgraf",
            "storageAccountKey": "WWTaza86E7DiNwZ0oH6YHYNy4gtBiS73HR/4Wlb4r1JLILg+c99MSyPbwteZ5v0H2ZZ3dE7TNWyI+AStDkZ0QA=="
          }
        },
        {
          "name": "grafana-dashboard",
          "azureFile": {
            "shareName": "grafana-data",
            "storageAccountName": "mystorageaccountgraf",
            "storageAccountKey": "WWTaza86E7DiNwZ0oH6YHYNy4gtBiS73HR/4Wlb4r1JLILg+c99MSyPbwteZ5v0H2ZZ3dE7TNWyI+AStDkZ0QA=="
          }
        }
      ]
    },
    "type": "Microsoft.ContainerInstance/containerGroups"
  }